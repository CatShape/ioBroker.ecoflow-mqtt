const ef = require('./ecoflow_utils.js');

function logger() {
	this.debug = function(text) {
		console.log(text);
	};
}
function configure() {
	this.msgUnknownMsgPstream = true;
	this.msgUnknownMsgPlug = true;
	this.showHex = true;
}

const that = () => this;

that.log = new logger();
that.config = new configure();

const message =
	'0a3c0a020801102018352001280138034002488a015002580170fbd5e98207800113880101ba0103696f73ca0110485735325a4448345346363636353845';

const message1 =
	'0ae2010ac2010800100018002000280030003800400048005000580460046805700578018001ae018801880e9001349801ba06a0018603a8019103b001e11fb80112c001c005c8018603d001ab04d801b904e00100e801abf4ffffffffffffff01f001e601f801248002b9048802119002c0029802cf24a002c512a80232b00200b80200c002f403d00202d80210e00200e80200f002c58801f802008003e80788030090030198031ea00350a80301b00300b80300c003fa01c8030fd003f02ed8038703e003ef2e10354014480170b5e721ca0110485735315a4f483453463455313231370acf030aae030a291225080110012a0f08001000180020092808300938e70f320e08001000180020002800300038001802122b08011225080110012a0f08001000180020122814300838e70f320e080010001800200028003000380018011a24080212202a0e0800100018002000280030003800320e08001000180020002800300038002224080312202a0e0800100018002000280030003800320e08001000180020002800300038002a24080412202a0e0800100018002000280030003800320e08001000180020002800300038003224080512202a0e0800100018002000280030003800320e08001000180020002800300038003a24080612202a0e0800100018002000280030003800320e08001000180020002800300038004224080712202a0e0800100018002000280030003800320e08001000180020002800300038004a24080812202a0e0800100018002000280030003800320e08001000180020002800300038005224080912202a0e0800100018002000280030003800320e08001000180020002800300038005a24080a12202a0e0800100018002000280030003800320e08001000180020002800300038001035401448860170b5e721ca0110485735315a4f48345346345531323137';

const message2 =
	'0a88020ada01080112220880f4f8ab0610011a180000000000000000000d233437240200000000000000000012220880f4f8ab0610021a1800000000000000000002030101020000000000000000000012220880f4f8ab0610031a1800000000000000000000000000000000000000000000000012220880f4f8ab0610041a1800000000000000000000000000000000000000000000000012220880f4f8ab0610071a180000000000000000000917231f130100000000000000000012220880f4f8ab0610081a18000000000000000000040c10181101000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346355434366363';

const message3 =
	'0a510a2b1a290802122308012a0f080010001800200c281b300838e70f320e0800100018002000280030003800180210351820200128014014488601502b5801ca0110485735315a4f483453463554343663630a360a0b8802c2018003a41788030a103518202001280140144801500b5801800103880103ca0110485735315a4f483453463554343663630a420a178801deb22280020c90024df002f6ffffffffffffffff0110351820200128014014480450175801800103880103ca0110485735315a4f48345346355434366363';

const message4 =
	'0ae6010ac401080010800218002000280030003800400048005000580760046805700578018001dd01880100900100980100a0019802a8018a03b001f61eb80106c001e601c8019802d001f103d801f303e00100e801a1feffffffffffffff01f001f001f8011e8002f30388021190028e029802cb24a002b512a80235b00200b80200c002f303d00202d80210e00200e80200f002c58801f802008003f20788030090030198031ea0035fa80301b00300b80300c0039601c80302d003f02ed803e712e003ef2ee8030010354014480170aec58c8101ca0110485735315a4f483453463455313231370ad1030aae030a291225080110012a0f08001000180020092808300938e70f320e08001000180020002800300038001802122b08011225080110012a0f08001000180020122814300838e70f320e080010001800200028003000380018011a24080212202a0e0800100018002000280030003800320e08001000180020002800300038002224080312202a0e0800100018002000280030003800320e08001000180020002800300038002a24080412202a0e0800100018002000280030003800320e08001000180020002800300038003224080512202a0e0800100018002000280030003800320e08001000180020002800300038003a24080612202a0e0800100018002000280030003800320e08001000180020002800300038004224080712202a0e0800100018002000280030003800320e08001000180020002800300038004a24080812202a0e0800100018002000280030003800320e08001000180020002800300038005224080912202a0e0800100018002000280030003800320e08001000180020002800300038005a24080a12202a0e0800100018002000280030003800320e08001000180020002800300038001035401448860170aec58c8101ca0110485735315a4f48345346345531323137';

const message5 = '0a300a059801b0970410351820200128014002480150055801800103880103ca0110485735325a4448345346363636393437';

const message6 =
	'0a370a0c9002e2ffffffffffffffff01103518202001280140024801500c5801800103880103ca0110485735325a4448345346363636393437';

const message7 = '0a300a0598019eeb0610351820200128014002480150055801800103880103ca0110485735325a4448345346363636393437';

const message8 =
	'0a320a077002980188a30710351820200128014002480150075801800103880103ca0110485735325a4448345346363636393437';

const fromHexString = (hexString) => new Uint8Array(hexString.match(/.{1,2}/g).map((byte) => parseInt(byte, 16)));
const uintArray = fromHexString(message4);

/*
//const buffer = Buffer.from(uintArray);
const buffer = Buffer.from(message8, 'hex');
//const buffer = Buffer.from(message4, 'base64');

let msgdecode = ef.pstreamDecode(that, buffer);

console.log(msgdecode);
console.log(JSON.stringify(msgdecode));
*/

const bad = [
	'0a410a167805c001ea2e8002a20ff002e2ffffffffffffffff0110351820200128014014480450165801800103880103ca0110485735315a4f483453463554343632'
];

const stream = [
	'0a310a0688021d88031410351820200128014014480150065801800103880103ca0110485735315a4f48345346355434363236',
	'0a430a1868147802c001e82e8002a00ff002ecffffffffffffffff0110351820200128014014480450185801800103880103ca0110485735315a4f48345346355434363236',
	'0a3c0a020800102018352001280138034014488101500258017098e4d4d20a800113880101ba0103696f73ca0110485735315a4f48345346355434363236',
	'0a2e0a0388031e10351820200128014014480150035801800103880103ca0110485735315a4f48345346355434363236',
	'0a310a0688021388031410351820200128014014480150065801800103880103ca0110485735315a4f483453463554343632360a400a1568148002a60fe00202f002ecffffffffffffffff0110351820200128014014480450155801800103880103ca0110485735315a4f48345346355434363236',
	'0a310a06b0020388030010351820200128014014480150065801800103880103ca0110485735315a4f483453463554343632360a320a078002ac0ff0020010351820200128014014480450075801800103880103ca0110485735315a4f48345346355434363236',
	'0a380a0dd00101b002018803a006e80301103518202001280140144801500d5801800103880103ca0110485735315a4f483453463554343632360a500a2568ee0578faffffffffffffffff01c001eb2e80028a17e80203f002e0f9ffffffffffffff0110351820200128014014480450255801800103880103ca0110485735315a4f48345346355434363236',
	'0a8a020adc0108ffff0312220880d2adac0610011a1800000000000000000000000000000000000000000000000012220880d2adac0610021a1800000000000000000000000000000000000000000000000012220880d2adac0610031a1800000000000000000000000000000000000000000000000012220880d2adac0610041a1800000000000000000000000000000000000000000000000012220880d2adac0610071a1800000000000000000000000000000000000000000000000012220880d2adac0610081a18000000000000000000000000000000000000000000000000103518202001280140fe01482050dc015801800103880103ca0110485735315a4f48345346355434363236',
	'0a320a078802138803f80510351820200128014014480150075801800103880103ca0110485735315a4f483453463554343632360a490a1e68820678ffffffffffffffffff0180028f17f00288faffffffffffffff01103518202001280140144804501e5801800103880103ca0110485735315a4f48345346355434363236',
	'0a320a07d001008803820610351820200128014014480150075801800103880103ca0110485735315a4f483453463554343632360a410a1668a00680028d17e80200f002fef9ffffffffffffff0110351820200128014014480450165801800103880103ca0110485735315a4f48345346355434363236',
	'0a340a0968ee0578038002911710351820200128014014480450095801800103880103ca0110485735315a4f48345346355434363236',

	'0a790a4d08ffff0312230880d2adac0610051a190000000000009b01000000000000000000000000000000000012220880d2adac0610061a183c3c3c3c3c3c3c3c1d000000000000000000000000000000103518202001280140fe014820504d5801800103880103ca0110485735325a4448345346363636353832'
];

const aherby = [
	'0a36102018352001280138034002488e01580170daf3d4d202800113880101ba0103696f73ca0110485735325a4448345346363636353832',

	'0a36102018352001280138034002488e01580170daf3d4d202800113880101ba0103696f73ca0110485735325a4448345346363636353832',

	'0a2e0a03b8020010351820200128014002480150035801800103880103ca0110485735325a4448345346363636353832',

	'0a340a099801eec2ac0180020210351820200128014002480150095801800103880103ca0110485735325a4448345346363636353832',

	'0a330a089801c9db1380020210351820200128014002480150085801800103880103ca0110485735325a4448345346363636393337',

	'0a36102018352001280138034002488e01580170c094d5d202800113880101ba0103696f73ca0110485735325a4448345346363636393337',

	'0a36102018352001280138034002488e01580170c094d5d202800113880101ba0103696f73ca0110485735325a4448345346363636393337',

	'0a2e0a03b8020010351820200128014002480150035801800103880103ca0110485735325a4448345346363636393337',

	'0a3c0a020801102018352001280138034002488e015002580170f6c7d5d202800113880101ba0103696f73ca0110485735325a4448345346363636353832',

	'0a3c0a020801102018352001280138034002488e015002580170f6c7d5d202800113880101ba0103696f73ca0110485735325a4448345346363636353832',

	'0a3c0a020801102018352001280138034002488e015002580170f6c7d5d202800113880101ba0103696f73ca0110485735325a4448345346363636393337',

	'0a3c0a020801102018352001280138034002488e015002580170f6c7d5d202800113880101ba0103696f73ca0110485735325a4448345346363636393337',

	'0a370a0c9002e0f9ffffffffffffff01103518202001280140024801500c5801800103880103ca0110485735325a4448345346363636353832',

	'0a3a0a0f50f8059002e0f9ffffffffffffff01103518202001280140024801500f5801800103880103ca0110485735325a4448345346363636393337',

	'0a3a0a0f50e405900288faffffffffffffff01103518202001280140024801500f5801800103880103ca0110485735325a4448345346363636393337',
	'0a370a0c900288faffffffffffffff01103518202001280140024801500c5801800103880103ca0110485735325a4448345346363636353832',

	'0a4f0a151211080110012a0b18182000281c300c38e70f18031020183520012801380340024884015015580170c480b4ee02800113880101ba0103696f73ca0110485735325a4448345346363636393337',

	'0a4f0a151211080110012a0b18182000281c300c38e70f18031020183520012801380340024884015015580170ceefbcee02800113880101ba0103696f73ca0110485735325a4448345346363636393337',
	'0a36102018352001280138034002488601580170e9fabfee02800113880101ba0103696f73ca0110485735325a4448345346363636393337',
	'0a4f0a151211080110012a0b181c2000281c300c38e70f18041020183520012801380340024884015015580170a8e6c3ee02800113880101ba0103696f73ca0110485735325a4448345346363636393337',
	'0a3d0a0408c58801102018352001280138034020480b5004580170eef2c7ee0a800113880101ba0103696f73ca0110485735315a4f48345346355434363236'
];
const aherby2 = [
	'0a4f0a151211080110012a0b18182000281c300c38e70f18031020183520012801380340024884015015580170c480b4ee02800113880101ba0103696f73ca0110485735325a4448345346363636393337',
	'0a4d0a13120f08012a0b18182000281c300c38e70f1803102018352001280138034002488401501358017092c7bcee02800113880101ba0103696f73ca0110485735325a4448345346363636393337',
	'0a3c0a020801102018352001280138034002488e015002580170c2acf58003800113880101ba0103696f73ca0110485735325a4448345346363636353832',
	'0a3d0a0308e3041020183520012801380340024882015003580170d1eba88d03800113880101ba0103696f73ca0110485735325a4448345346363636353832',
	'0a36102018352001280138034002488601580170e9fabfee02800113880101ba0103696f73ca0110485735325a4448345346363636393337',
	'0a3d0a0308d405102018352001280138034002488201500358017094e897fe02800113880101ba0103696f73ca0110485735325a4448345346363636353832'
];

const aherby3 = [
	'0a10102018207095d8e8b603ba0103696f73',
	'0a510a1708011211080110012a0b18222012281d300c38e70f1804102018352001280138034002488401501758017095d8e8b603800113880101ba0103696f73ca0110485735325a4448345346363636353832',
	'0a780a4c08ffff031222088098b8ac0610051a18010101010101010101010101010104471f122600000000001222088098b8ac0610061a183c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c210000000000103518202001280140fe014820504c5801800103880103ca0110485735325a4448345346363636393337',
	'0a4f0a150801120f08012a0b18222012281d300c38e70f18041020183520012801380340024884015015580170fc99e9b603800113880101ba0103696f73ca0110485735325a4448345346363636353832',
	'0a4f0a150801120f08012a0b18222012281d300c38e70f18041020183520012801380340024884015015580170fc99e9b603800113880101ba0103696f73ca0110485735325a4448345346363636353832'
];

const aherby4 = [
	'0a300a059801a6cb2010351820200128014002480150055801800103880103ca0110485735325a4448345346363636393337',
	'0a36102018352001280138034002488a01580170fc9b9eb703800113880101ba0103696f73ca0110485735325a4448345346363636353832',
	'0a2e0a0350c60510351820200128014002480150035801800103880103ca0110485735325a4448345346363636393337',
	'0a36102018352001280138034002488a01580170fc9b9eb703800113880101ba0103696f73ca0110485735325a4448345346363636353832',
	'0a300a059801bdce2010351820200128014002480150055801800103880103ca0110485735325a4448345346363636393337',
	'0a310a0678019801920310351820200128014002480150065801800103880103ca0110485735325a4448345346363636353832',
	'0a3c0a020801102018352001280138034002488a015002580170befab6b703800113880101ba0103696f73ca0110485735325a4448345346363636353832',

	'0a370a0c9002e0f9ffffffffffffff01103518202001280140024801500c5801800103880103ca0110485735325a4448345346363636353832'
];

const apollosk = [
	'0a310a06d0010090026410351820200128014014480150065801800103880103ca0110485735315a4f483453463455303338330a2f0a048002d41210351820200128014014480450045801800103880103ca0110485735315a4f48345346345530333833',
	'0a2e0a03d0010110351820200128014014480150035801800103880103ca0110485735315a4f483453463455303338330a2f0a048002d21210351820200128014014480450045801800103880103ca0110485735315a4f48345346345530333833',
	'0a8a020adc0108ffff0312220880bcf7ac0610011a1800000000000000000000000000000000000000000000000012220880bcf7ac0610021a1800000000000000000000000000000000000000000000000012220880bcf7ac0610031a1800000000000000000000000000000000000000000000000012220880bcf7ac0610041a1800000000000000000000000000000000000000000000000012220880bcf7ac0610071a1800000000000000000000000000000000000000000000000012220880bcf7ac0610081a18000000000000000000000000000000000000000000000000103518202001280140fe01482050dc015801800103880103ca0110485735315a4f48345346345530333833',
	'0a2f0a048002d01210351820200128014014480450045801800103880103ca0110485735315a4f48345346345530333833',
	'0a2e0a0390026e10351820200128014014480150035801800103880103ca0110485735315a4f483453463455303338330a2f0a048002ce1210351820200128014014480450045801800103880103ca0110485735315a4f48345346345530333833',
	'0a2f0a048002cc1210351820200128014014480450045801800103880103ca0110485735315a4f48345346345530333833',
	'0a2e0a0390026410351820200128014014480150035801800103880103ca0110485735315a4f483453463455303338330a2f0a048002ca1210351820200128014014480450045801800103880103ca0110485735315a4f48345346345530333833',
	'0a310a0688021890026e10351820200128014014480150065801800103880103ca0110485735315a4f483453463455303338330a2f0a048002c81210351820200128014014480450045801800103880103ca0110485735315a4f48345346345530333833',
	'0a8a020adc0108ffff0312220880bcf7ac0610011a1800000000000000000000000000000000000000000000000012220880bcf7ac0610021a1800000000000000000000000000000000000000000000000012220880bcf7ac0610031a180000000000000000000000000000000000000',
	'0a320a078001dc02d0010110351820200128014014480150075801800103880103ca0110485735315a4f483453463455303338330a330a08c001e62e8002e41110351820200128014014480450085801800103880103ca0110485735315a4f48345346345530333833'
];

const plugunkn = [
	'0a3e0a120802120608f8d394ad06120608d0d894ad061035182020012801400248850150125801800103880103ca0110485735325a4448345346363837313035',
	'0a600a340801120608e8b794ad06120808c0bc94ad06181e12060898c194ad06120608f0c594ad06120608c8ca94ad06120608a0cf94ad061035182020012801400248850150345801800103880103ca0110485735325a44483453463638373130350a4b0a263a24080612202a0e0800100018002000280030003800320e080010001800200028003000380010351820200128014002480250265801ca0110485735325a4448345346363837313035',
	'0a380a0c08ffff03120608988c95ad0610351820200128014002488701500c5801800103880103ca0110485735325a44483453463638373130350a780a4c08ffff0312220880eb91ad0610051a1800000000000000000000000500000000000000000000000012220880eb91ad0610061a1800000000000000000000000b3c0000000000000000000000103518202001280140fe014820504c5801800103880103ca0110485735325a44483453463638373130350a2e0a0398013b10351820200128014002480150035801800103880103ca0110485735325a4448345346363837313035',
	'0a3e0a120802120608f8d394ad06120608d0d894ad061035182020012801400248850150125801800103880103ca0110485735325a4448345346363837313035',
	'0a600a340801120608e8b794ad06120808c0bc94ad06181e12060898c194ad06120608f0c594ad06120608c8ca94ad06120608a0cf94ad061035182020012801400248850150345801800103880103ca0110485735325a44483453463638373130350a4b0a263a24080612202a0e0800100018002000280030003800320e080010001800200028003000380010351820200128014002480250265801ca0110485735325a4448345346363837313035',
	'0a380a0c08ffff03120608988c95ad0610351820200128014002488701500c5801800103880103ca0110485735325a44483453463638373130350a780a4c08ffff0312220880eb91ad0610051a1800000000000000000000000500000000000000000000000012220880eb91ad0610061a1800000000000000000000000b3c0000000000000000000000103518202001280140fe014820504c5801800103880103ca0110485735325a44483453463638373130350a2e0a0398013b10351820200128014002480150035801800103880103ca0110485735325a4448345346363837313035',
	'0a780a4c08ffff0312220880eb91ad0610051a1800000000000000000000000500000000000000000000000012220880eb91ad0610061a1800000000000000000000000b3c000a2e3c0c000000000000103518202001280140fe014820504c5801800103880103ca0110485735325a4448345346363837313035',
	''
];

const histenergy = [
	'0a780a4c08ffff03122208808e97ad0610051a18000000000000000000000000000000000000000000000000122208808e97ad0610061a183c3c3c3c3c3c3c2000000000000000000000000000000000103518202001280140fe014820504c5801800103880103ca0110485735325a4448345346363837313035',
	'0a88020ada01080112220880c88cad0610011a1800000000000000000000000000000000000000000000000012220880c88cad0610021a1800000000000000000000000000000000000000000000000012220880c88cad0610031a18000000000000000000000915292d1b01000000000000000012220880c88cad0610041a1800000000000000000000000000000000000000000000000012220880c88cad0610071a1800000000000000000000000004080400000000000000000012220880c88cad0610081a18000000000000000000000915262719020000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080212220880a587ad0610011a1800000000000000000000000000000000000000000000000012220880a587ad0610021a1800000000000000000000000000000000000000000000000012220880a587ad0610031a1800000000000000000000000000000000000000000000000012220880a587ad0610041a1800000000000000000000000000000000000000000000000012220880a587ad0610071a1800000000000000000000000000000000000000000000000012220880a587ad0610081a18000000000000000000000000000000000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada010803122208808282ad0610011a18000000000000000000000000000000000000000000000000122208808282ad0610021a18000000000000000000000000000000000000000000000000122208808282ad0610031a18000000000000000000000000000000000000000000000000122208808282ad0610041a18000000000000000000000000000000000000000000000000122208808282ad0610071a18000000000000000000000000000000000000000000000000122208808282ad0610081a18000000000000000000000000000000000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a8c020ade01080412220880dffcac0610011a180000000000000000000000000000000000006c6c6c6c6c6c12220880dffcac0610021a1800000000000000000000000000000000000000000000000012250880dffcac0610031a1b00000000000000000012a901c5018d01101b00000000000000000012220880dffcac0610041a180000000000000000000000000000000000007070706f6f6f12220880dffcac0610071a180000000000000000000b6a3f11040300000000000000000012230880dffcac0610081a19000000000000000000064189017e0c18000000000000000000103518202001280140fe01482050de015801800103880103ca0110485735315a4f48345346345531323137',
	'0a8c020ade01080512220880bcf7ac0610011a186c00000000000000000000000000000000006c6c6c6c6c0012220880bcf7ac0610021a1800000000000000000000000000000000000000000000000012250880bcf7ac0610031a1b00000000000000000013a201b9018301131100000000000000000012220880bcf7ac0610041a186f00000000000000000000000000000000007071706f6f0012220880bcf7ac0610071a1800000000000000000011683c10050200000000000000000012230880bcf7ac0610081a19000000000000000000033f8201751011000000000000000000103518202001280140fe01482050de015801800103880103ca0110485735315a4f48345346345531323137',
	'0a8c020ade0108061222088099f2ac0610011a180000000000000000000000000000000000006c6c6c6c6c6c1222088099f2ac0610021a180000000000000000000000000000000000000000000000001225088099f2ac0610031a1b00000000000000000014b501d0018f010f120000000000000000001222088099f2ac0610041a180000000000000000000000000000000000006f70706f6f6f1222088099f2ac0610071a180000000000000000001075431104030000000000000000001223088099f2ac0610081a19000000000000000000044490017f0b10000000000000000000103518202001280140fe01482050de015801800103880103ca0110485735315a4f48345346345531323137',
	'0a8a020adc0108ffff03122208808e97ad0610011a18000000000000000000000000000000000000000000000000122208808e97ad0610021a18000000000000000000000000000000000000000000000000122208808e97ad0610031a18000000000000000000000000000000000000000000000000122208808e97ad0610041a18000000000000000000000000000000000000000000000000122208808e97ad0610071a18000000000000000000000000000000000000000000000000122208808e97ad0610081a18000000000000000000000000000000000000000000000000103518202001280140fe01482050dc015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080712220880f6ecac0610011a180000000000000000000000000000000000006c6c6c00000012220880f6ecac0610021a1800000000000000000000000000000000000000000000000012220880f6ecac0610031a180000000000000000040d335a752e0d00000000000000000012220880f6ecac0610041a180000000000000000000000000000000000006f6f6f00000012220880f6ecac0610071a1800000000000000000000111c13080200000000000000000012220880f6ecac0610081a180000000000000000040d234165280e000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080812220880d3e7ac0610011a1800000000000000000000000000000000000000000000000012220880d3e7ac0610021a1800000000000000000000000000000000000000000000000012220880d3e7ac0610031a1800000000000000000000000000000000000000000000000012220880d3e7ac0610041a1800000000000000000000000000000000000000000000000012220880d3e7ac0610071a1800000000000000000000000000000000000000000000000012220880d3e7ac0610081a18000000000000000000000000000000000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080912220880b0e2ac0610011a1800000000000000000000000000000000000000000000000012220880b0e2ac0610021a1800000000000000000000000000000000000000000000000012220880b0e2ac0610031a180000000000000000040d0e0b00000000000000000000000012220880b0e2ac0610041a1800000000000000000000000000000000000000000000000012220880b0e2ac0610071a1800000000000000000000000000000000000000000000000012220880b0e2ac0610081a180000000000000000030c0e0c000000000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080a122208808dddac0610011a18000000000000000000000000000005000000000000000000122208808dddac0610021a18000000000000000000000000000000000000000000000000122208808dddac0610031a1800000000000000000016760d0f0703000000000000000000122208808dddac0610041a18000000000000000000000000000006000000000000000000122208808dddac0610071a18000000000000000000064900000000000000000000000000122208808dddac0610081a180000000000000000000f2f0e110904000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080b12220880ead7ac0610011a1800000000000000000000000000000000000000000000000012220880ead7ac0610021a1800000000000000000000000000000000000000000000000012220880ead7ac0610031a1800000000000000000000000604000000000000000000000012220880ead7ac0610041a1800000000000000000000000000000000000000000000000012220880ead7ac0610071a1800000000000000000000000000000000000000000000000012220880ead7ac0610081a18000000000000000000000006050000000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080c12220880c7d2ac0610011a1800000000000000000000000000000000000000000000000012220880c7d2ac0610021a1800000000000000000000000000000000000000000000000012220880c7d2ac0610031a18000000000000000000040f0011050000000000000000000012220880c7d2ac0610041a1800000000000000000000000201010302000000000000000012220880c7d2ac0610071a1800000000000000000000030004000000000000000000000012220880c7d2ac0610081a18000000000000000000050d000d0500000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080e1222088081c8ac0610011a180000000000000000000000000000070600006600000000001222088081c8ac0610021a180000000000000000000000000000000000000000000000001222088081c8ac0610031a180000000000000000001b4b231f17000000000000000000001222088081c8ac0610041a180000000000000000000000000000090800006900000000001222088081c8ac0610071a180000000000000000001423090504000000000000000000001222088081c8ac0610081a18000000000000000000082a1b1a1400000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137'
];

const histpower = [
	'0a88020ada01080112220880c88cad0610011a1800000000000000000000000000000000000000000000000012220880c88cad0610021a1800000000000000000000000000000000000000000000000012220880c88cad0610031a18000000000000000000000915292d1b01000000000000000012220880c88cad0610041a1800000000000000000000000000000000000000000000000012220880c88cad0610071a1800000000000000000000000004080400000000000000000012220880c88cad0610081a18000000000000000000000915262719020000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a9f010a730802120608c0f193ad0612130898f693ad0628f9ffffffffffffffff013804121308f0fa93ad0628f0ffffffffffffffff013810121308c8ff93ad0628ebffffffffffffffff013814121308a08494ad0628eeffffffffffffffff013810121308f88894ad0628f7ffffffffffffffff0138081035182020012801401448880150735801800103880103ca0110485735315a4f48345346345531323137',
	'0aae010a80010803121308d08d94ad0628f8ffffffffffffffff013808121308a89294ad0628f7ffffffffffffffff013808121308809794ad0628f5ffffffffffffffff013808121308d89b94ad0628f8ffffffffffffffff013808121308b0a094ad0628f4ffffffffffffffff01380c12130888a594ad0628f2ffffffffffffffff01380c103518202001280140144888015080015801800103880103ca0110485735315a4f48345346345531323137',
	'0aae010a80010804121308e0a994ad0628f4ffffffffffffffff01380c121308b8ae94ad0628f1ffffffffffffffff01380c12130890b394ad0628edffffffffffffffff013810121308e8b794ad0628edffffffffffffffff013810121308c0bc94ad0628f4ffffffffffffffff01380c12130898c194ad0628f4ffffffffffffffff01380c103518202001280140144888015080015801800103880103ca0110485735315a4f48345346345531323137',
	'0aae010a80010805121308f0c594ad0628efffffffffffffffff013810121308c8ca94ad0628eaffffffffffffffff013814121308a0cf94ad0628ebffffffffffffffff013814121308f8d394ad0628f3ffffffffffffffff01380c121308d0d894ad0628f9ffffffffffffffff013808121308a8dd94ad0628feffffffffffffffff013804103518202001280140144888015080015801800103880103ca0110485735315a4f48345346345531323137',
	'0aae010a80010805121308f0c594ad0628efffffffffffffffff013810121308c8ca94ad0628eaffffffffffffffff013814121308a0cf94ad0628ebffffffffffffffff013814121308f8d394ad0628f3ffffffffffffffff01380c121308d0d894ad0628f9ffffffffffffffff013808121308a8dd94ad0628feffffffffffffffff013804103518202001280140144888015080015801800103880103ca0110485735315a4f48345346345531323137',
	'0a85010a59080612130880e294ad0628feffffffffffffffff013804121308d8e694ad0628fdffffffffffffffff013804121308b0eb94ad0628fcffffffffffffffff01380412060888f094ad06120608e0f494ad06120608b8f994ad061035182020012801401448880150595801800103880103ca0110485735315a4f48345346345531323137',
	'0a88020ada01080712220880f6ecac0610011a180000000000000000000000000000000000006c6c6c00000012220880f6ecac0610021a1800000000000000000000000000000000000000000000000012220880f6ecac0610031a180000000000000000040d335a752e0d00000000000000000012220880f6ecac0610041a180000000000000000000000000000000000006f6f6f00000012220880f6ecac0610071a1800000000000000000000111c13080200000000000000000012220880f6ecac0610081a180000000000000000040d234165280e000000000000000000103518202001280140fe01482050da015801800103880103ca0110485735315a4f48345346345531323137',
	'0a560a2a0808120608a09a95ad06120608f89e95ad06120608d0a395ad06120608a8a895ad0612060880ad95ad0610351820200128014014488801502a5801800103880103ca0110485735315a4f48345346345531323137',
	'0a780a4c080b120608c8dc8ead06120608a0e18ead06120608f8e58ead06120608d0ea8ead06121308a8ef8ead0628fbffffffffffffffff01380412130880f48ead0628f1ffffffffffffffff01380c10351820200128014014488801504c5801800103880103ca0110485735315a4f48345346345531323137',
	'0aae010a8001080c121308d8f88ead0628f1ffffffffffffffff01380c121308b0fd8ead0628edffffffffffffffff01381012130888828fad0628edffffffffffffffff013810121308e0868fad0628ebffffffffffffffff013814121308b88b8fad0628efffffffffffffffff01381012130890908fad0628edffffffffffffffff013814103518202001280140144888015080015801800103880103ca0110485735315a4f48345346345531323137',
	'0aae010a8001080d121308e8948fad0628e8ffffffffffffffff013818121308c0998fad0628e7ffffffffffffffff013818121308989e8fad0628e0ffffffffffffffff013820121308f0a28fad0628e4ffffffffffffffff01381c121308c8a78fad0628dfffffffffffffffff013820121308a0ac8fad0628e6ffffffffffffffff013818103518202001280140144888015080015801800103880103ca0110485735315a4f48345346345531323137',
	'0ab8010a8a01080e121308f8b08fad0628ddffffffffffffffff013824121508d0b58fad0628a5ffffffffffffffff0130183844121508a8ba8fad0628b9ffffffffffffffff01300c383812150880bf8fad0628d5ffffffffffffffff0130083824121508d8c38fad0628daffffffffffffffff0130043820121508b0c88fad0628d6ffffffffffffffff013008382410351820200128014014488801508a015801800103880103ca0110485735315a4f48345346345531323137'
];

for (let i = 0; i < histenergy.length; i++) {
	console.log('  ------> ' + i);
	const buffer = Buffer.from(histenergy[i], 'hex');
	//const buffer = Buffer.from(message4, 'base64');
	let msgdecode = null;
	try {
		msgdecode = ef.pstreamDecode(that, buffer);
	} catch (error) {
		console.log('call -> ' + error);
	}

	console.log(msgdecode);
	console.log(JSON.stringify(msgdecode));
}
let pdevicesStates = {};
let devStates = require('./ecoflow_data.js').pstreamStates;
let pdevicesStatesDict = require('./ecoflow_data.js').pstreamStatesDict['pstream'];
pdevicesStates['pstream'] = ef.statesFromDict(devStates, pdevicesStatesDict);

//console.log(JSON.stringify(pdevicesStates));

let pdevices = {
	HW51ZOH4SF4U1217: { devType: 'pstream600', devName: 'Stream SP4' },
	DAEBZ5ZE4151148: { devType: 'deltamax', devName: 'Station mit Stream' }
};
for (const [ device, value ] of Object.entries(pdevices)) {
	console.log(device);
	console.log(value);
	const devtype = value['devType'];
	if (devtype === 'pstream600' || devtype === 'pstream800' || devtype === 'plug') {
		console.log(device + ' -> latestQuotas requested');
	}
}

/*

hier könnte noch das geplante ausschalten:
/thing/property/get:0a10102018207095d8e8b603ba0103696f73
javascript.0
2023-12-29 19:33:20.803 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Decodierte Nachricht:{}
javascript.0
2023-12-29 19:33:20.803 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Nachricht: {"header":[{"pdata":"08011211080110012a0b18222012281d300c38e70f1804","src":32,"dest":53,"dSrc":1,"dDest":1,"checkType":3,"cmdFunc":2,"cmdId":132,"dataLen":23,"needAck":1,"seq":920267797,"version":19,"payloadVer":1,"from":"ios","deviceSn":"HW52ZDH4SF666582"}]}
javascript.0
2023-12-29 19:33:20.803 info script.js.Ecoflow_Dynamische_Leistung_V1_2: hexString: 0a510a1708011211080110012a0b18222012281d300c38e70f1804102018352001280138034002488401501758017095d8e8b603800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0
2023-12-29 19:33:20.802 warn script.js.Ecoflow_Dynamische_Leistung_V1_2: Nicht definierter cmd_func-Wert. [Wasserkocher] cmdId:132 cmdFunc:2
javascript.0
2023-12-29 19:33:20.756 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Binäre Nachricht empfangen:/app/1669741428735926273/HW52ZDH4SF666582/thing/property/set:0a510a1708011211080110012a0b18222012281d300c38e70f1804102018352001280138034002488401501758017095d8e8b603800113880101ba0103696f73ca0110485735325a4448345346363636353832

hier das deaktivieren drin sein:

/property/HW52ZDH4SF666937:0a780a4c08ffff031222088098b8ac0610051a18010101010101010101010101010104471f122600000000001222088098b8ac0610061a183c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c210000000000103518202001280140fe014820504c5801800103880103ca0110485735325a4448345346363636393337
javascript.0
2023-12-29 19:33:29.183 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Decodierte Nachricht:{}
javascript.0
2023-12-29 19:33:29.183 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Nachricht: {"header":[{"pdata":"0801120f08012a0b18222012281d300c38e70f1804","src":32,"dest":53,"dSrc":1,"dDest":1,"checkType":3,"cmdFunc":2,"cmdId":132,"dataLen":21,"needAck":1,"seq":920276220,"version":19,"payloadVer":1,"from":"ios","deviceSn":"HW52ZDH4SF666582"}]}
javascript.0
2023-12-29 19:33:29.183 info script.js.Ecoflow_Dynamische_Leistung_V1_2: hexString: 0a4f0a150801120f08012a0b18222012281d300c38e70f18041020183520012801380340024884015015580170fc99e9b603800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0
2023-12-29 19:33:29.183 warn script.js.Ecoflow_Dynamische_Leistung_V1_2: Nicht definierter cmd_func-Wert. [Wasserkocher] cmdId:132 cmdFunc:2
javascript.0
2023-12-29 19:33:29.178 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Binäre Nachricht empfangen:/app/1669741428735926273/HW52ZDH4SF666582/thing/property/set:0a4f0a150801120f08012a0b18222012281d300c38e70f18041020183520012801380340024884015015580170fc99e9b603800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0

*/

/*


hier ist Ecoflow-Mesh einschalten:

/property/HW52ZDH4SF666937:0a300a059801a6cb2010351820200128014002480150055801800103880103ca0110485735325a4448345346363636393337
javascript.0
2023-12-29 19:47:57.851 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Decodierte Nachricht:{}
javascript.0
2023-12-29 19:47:57.851 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Nachricht: {"header":[{"src":32,"dest":53,"dSrc":1,"dDest":1,"checkType":3,"cmdFunc":2,"cmdId":138,"needAck":1,"seq":921144828,"version":19,"payloadVer":1,"from":"ios","deviceSn":"HW52ZDH4SF666582"}]}
javascript.0
2023-12-29 19:47:57.851 info script.js.Ecoflow_Dynamische_Leistung_V1_2: hexString: 0a36102018352001280138034002488a01580170fc9b9eb703800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0
2023-12-29 19:47:57.851 warn script.js.Ecoflow_Dynamische_Leistung_V1_2: Nicht definierter cmd_func-Wert. [Wasserkocher] cmdId:138 cmdFunc:2
javascript.0
2023-12-29 19:47:57.806 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Binäre Nachricht empfangen:/app/1669741428735926273/HW52ZDH4SF666582/thing/property/set:0a36102018352001280138034002488a01580170fc9b9eb703800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0



und ausschalten vielleicht drin:

/property/HW52ZDH4SF666937:0a2e0a0350c60510351820200128014002480150035801800103880103ca0110485735325a4448345346363636393337
javascript.0
2023-12-29 19:48:05.856 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Decodierte Nachricht:{}
javascript.0
2023-12-29 19:48:05.856 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Nachricht: {"header":[{"pdata":"0801","src":32,"dest":53,"dSrc":1,"dDest":1,"checkType":3,"cmdFunc":2,"cmdId":138,"dataLen":2,"needAck":1,"seq":921152873,"version":19,"payloadVer":1,"from":"ios","deviceSn":"HW52ZDH4SF666582"}]}
javascript.0
2023-12-29 19:48:05.856 info script.js.Ecoflow_Dynamische_Leistung_V1_2: hexString: 0a3c0a020801102018352001280138034002488a015002580170e9da9eb703800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0
2023-12-29 19:48:05.856 warn script.js.Ecoflow_Dynamische_Leistung_V1_2: Nicht definierter cmd_func-Wert. [Wasserkocher] cmdId:138 cmdFunc:2
javascript.0
2023-12-29 19:48:05.846 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Binäre Nachricht empfangen:/app/1669741428735926273/HW52ZDH4SF666582/thing/property/set:0a3c0a020801102018352001280138034002488a015002580170e9da9eb703800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0


*/

/*
Decodierte Nachricht:{"data":{"plug_heartbeat_pack":{}}}
javascript.0
2023-12-29 19:54:45.608 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Binäre Nachricht empfangen:/app/device/property/HW52ZDH4SF666937:0a300a059801bdce2010351820200128014002480150055801800103880103ca0110485735325a4448345346363636393337
javascript.0
2023-12-29 19:54:44.651 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Decodierte Nachricht:{"data":{"plug_heartbeat_pack":{"meshEnable":1}}}
javascript.0
2023-12-29 19:54:44.603 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Binäre Nachricht empfangen:/app/device/property/HW52ZDH4SF666582:0a310a0678019801920310351820200128014002480150065801800103880103ca0110485735325a4448345346363636353832
javascript.0
2023-12-29 19:54:43.122 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Decodierte Nachricht:{}
javascript.0
2023-12-29 19:54:43.122 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Nachricht: {"header":[{"pdata":"0801","src":32,"dest":53,"dSrc":1,"dDest":1,"checkType":3,"cmdFunc":2,"cmdId":138,"dataLen":2,"needAck":1,"seq":921550142,"version":19,"payloadVer":1,"from":"ios","deviceSn":"HW52ZDH4SF666582"}]}
javascript.0
2023-12-29 19:54:43.122 info script.js.Ecoflow_Dynamische_Leistung_V1_2: hexString: 0a3c0a020801102018352001280138034002488a015002580170befab6b703800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0
2023-12-29 19:54:43.122 warn script.js.Ecoflow_Dynamische_Leistung_V1_2: Nicht definierter cmd_func-Wert. [Wasserkocher] cmdId:138 cmdFunc:2
javascript.0
2023-12-29 19:54:43.115 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Binäre Nachricht empfangen:/app/1669741428735926273/HW52ZDH4SF666582/thing/property/set:0a3c0a020801102018352001280138034002488a015002580170befab6b703800113880101ba0103696f73ca0110485735325a4448345346363636353832
javascript.0
2023-12-29 19:54:42.507 info script.js.Ecoflow_Dynamische_Leistung_V1_2: Decodierte Nachricht:{"data":{"plug_heartbeat_pack":{}}}
*/
